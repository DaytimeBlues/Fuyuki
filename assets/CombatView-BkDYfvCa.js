import{j as e,u as t,n as s,o as a,q as i,r,a as n,t as l,v as d,w as o,d as c,x as m,y as x,z as h,A as p,B as u,C as b,D as g,E as v,F as j,G as f}from"./index-DqUbq9FF.js";import{r as N}from"./react-vendor-D-3wKq8v.js";import{r as w,w as y,c as k,P as C,p as S,X as z,Z as P,a as A,A as $,x as M,y as U,z as I,G as T,S as R,J as H,K as L,L as D,I as F,N as E,g as G,h as Z,O as W}from"./ui-vendor-CnX1xj8W.js";import"./redux-vendor-DpCagSso.js";const O=[{name:"Skeleton",type:"Medium Undead, Lawful Evil",ac:"13 (Armor Scraps)",hp:"13 (2d8 + 4)",speed:"30 ft.",stats:{str:10,dex:14,con:15,int:6,wis:8,cha:5},damageImmunities:"Poison",conditionImmunities:"Exhaustion, Poisoned",senses:"Darkvision 60 ft., Passive Perception 9",languages:"Understands languages it knew in life but can't speak",actions:[{name:"Shortsword",desc:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 5 (1d6 + 2) piercing damage."},{name:"Shortbow",desc:"Ranged Weapon Attack: +4 to hit, range 80/320 ft., one target. Hit: 5 (1d6 + 2) piercing damage."}]},{name:"Zombie",type:"Medium Undead, Neutral Evil",ac:"8",hp:"22 (3d8 + 9)",speed:"20 ft.",stats:{str:13,dex:6,con:16,int:3,wis:6,cha:5},damageImmunities:"Poison",conditionImmunities:"Poisoned",senses:"Darkvision 60 ft., Passive Perception 8",languages:"Understands languages it knew in life but can't speak",traits:[{name:"Undead Fortitude",desc:"If damage reduces the zombie to 0 hit points, it must make a Constitution saving throw with a DC of 5 + the damage taken, unless the damage is radiant or from a critical hit. On a success, the zombie drops to 1 hit point instead."}],actions:[{name:"Slam",desc:"Melee Weapon Attack: +3 to hit, reach 5 ft., one target. Hit: 4 (1d6 + 1) bludgeoning damage."}]},{name:"Ghostly Spirit (Summon Undead)",type:"Medium Undead",ac:"11 + Level (14)",hp:"30 + 10/Level (40)",speed:"0 ft., fly 40 ft. (hover)",stats:{str:4,dex:16,con:16,int:10,wis:10,cha:16},damageImmunities:"Necrotic, Poison",conditionImmunities:"Frightened, Grappled, Paralyzed, Petrified, Poisoned, Prone, Restrained",senses:"Darkvision 60 ft., Passive Perception 10",languages:"Understands languages you speak",traits:[{name:"Incorporeal Passage",desc:"The spirit can move through other creatures and objects as if they were difficult terrain. It takes 5 (1d10) force damage if it ends its turn inside an object."}],actions:[{name:"Multiattack",desc:"The spirit makes a number of attacks equal to half this spell's level (rounded down)."},{name:"Deathly Touch",desc:"Melee Weapon Attack: +Your Spell Attack Modifier to hit, reach 5 ft., one creature. Hit: 1d8 + 3 + Level Necrotic damage, and the creature must succeed on a Wisdom saving throw against your Spell Save DC or be frightened of the undead until the end of the target's next turn."}]},{name:"Putrid Spirit (Summon Undead)",type:"Medium Undead",ac:"11 + Level (14)",hp:"30 + 10/Level (40)",speed:"30 ft.",stats:{str:16,dex:10,con:16,int:10,wis:10,cha:4},damageImmunities:"Necrotic, Poison",conditionImmunities:"Frightened, Poisoned",senses:"Darkvision 60 ft., Passive Perception 10",languages:"Understands languages you speak",traits:[{name:"Festering Aura",desc:"Any creature, other than you, that starts its turn within 5 feet of the spirit must succeed on a Constitution saving throw against your Spell Save DC or be poisoned until the start of its next turn."}],actions:[{name:"Multiattack",desc:"The spirit makes a number of attacks equal to half this spell's level (rounded down)."},{name:"Rotting Claw",desc:"Melee Weapon Attack: +Your Spell Attack Modifier to hit, reach 5 ft., one target. Hit: 1d6 + 3 + Level Slashing damage. If the target is poisoned, it must succeed on a Constitution saving throw against your Spell Save DC or be paralyzed until the end of its next turn."}]},{name:"Skeletal Spirit (Summon Undead)",type:"Medium Undead",ac:"11 + Level (14)",hp:"20 + 10/Level (30)",speed:"30 ft.",stats:{str:10,dex:16,con:15,int:6,wis:8,cha:5},damageImmunities:"Necrotic, Poison",conditionImmunities:"Exhaustion, Frightened, Poisoned",senses:"Darkvision 60 ft., Passive Perception 9",languages:"Understands languages you speak",actions:[{name:"Multiattack",desc:"The spirit makes a number of attacks equal to half this spell's level (rounded down)."},{name:"Grave Bolt",desc:"Ranged Spell Attack: +Your Spell Attack Modifier to hit, range 150 ft., one target. Hit: 2d4 + 3 + Level Necrotic damage."}]}];function q({minion:t,onUpdateMinion:s,onRemoveMinion:a}){const[i,r]=N.useState(!1),[n,l]=N.useState(!1),[d,o]=N.useState(0),c=N.useRef(t.hp),m=N.useRef(null);return N.useEffect(()=>{t.hp<c.current?(r(!0),l(!1),o(e=>e+1),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>r(!1),400)):t.hp>c.current&&(l(!0),r(!1),o(e=>e+1),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>l(!1),400)),c.current=t.hp},[t.hp]),N.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),e.jsxs("div",{className:"bg-card-elevated/60 border border-white/10 rounded-xl p-3 flex items-center justify-between transition-colors duration-200 "+(i?"damage-taken":""),"data-testid":"minion-card",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:["skeleton"===t.type.toLowerCase()?e.jsx(w,{size:14,className:"text-white"}):e.jsx(y,{size:14,className:"text-white"}),e.jsx("span",{className:"font-display text-parchment-light",children:t.name}),e.jsxs("span",{className:"text-xs text-muted",children:["AC ",t.ac]})]}),e.jsx("p",{className:"text-xs text-muted/70 truncate max-w-[150px] ml-6",children:t.notes})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-card/60 rounded-lg p-1 border border-white/10",children:[e.jsx("button",{onClick:()=>s(t.id,Math.max(0,t.hp-1)),className:"w-7 h-7 flex items-center justify-center hover:bg-red-500/20 text-muted hover:text-red-400 rounded transition-colors","data-testid":"minion-damage-btn",children:e.jsx(k,{size:14})}),e.jsx("input",{type:"number",value:t.hp,onChange:e=>s(t.id,parseInt(e.target.value)||0),className:"w-10 bg-transparent text-center font-display text-sm focus:outline-none border-b border-transparent focus:border-white/30 "+(i?"animate-number-pop-damage":n?"animate-number-pop-heal":""),"data-testid":"minion-hp-input"},d),e.jsx("button",{onClick:()=>s(t.id,Math.min(t.maxHp,t.hp+1)),className:"w-7 h-7 flex items-center justify-center hover:bg-white/20 text-muted hover:text-white rounded transition-colors","data-testid":"minion-heal-btn",children:e.jsx(C,{size:14})})]}),e.jsx("button",{onClick:()=>a(t.id),className:"p-2 hover:bg-red-500/10 text-muted hover:text-red-400 rounded-lg transition-colors","data-testid":"minion-remove-btn",children:e.jsx(S,{size:18})})]})]})}function B({minions:t,onUpdateMinion:s,onRemoveMinion:a}){return e.jsx("div",{className:"space-y-3",children:0===t.length?e.jsx("div",{className:"text-center py-12 text-muted italic font-display",children:"No undead servants raised..."}):t.map(t=>e.jsx(q,{minion:t,onUpdateMinion:s,onRemoveMinion:a},t.id))})}function _({isOpen:n,onClose:l,minions:d}){const o=t(),c=e=>{const t={Skeleton:"Skeleton",Zombie:"Zombie",Ghostly:"Ghostly Spirit (Summon Undead)",Putrid:"Putrid Spirit (Summon Undead)",Skeletal:"Skeletal Spirit (Summon Undead)"}[e],s=O.find(e=>e.name===t);if(!s)return;const i=["Ghostly","Putrid","Skeletal"].includes(e),r=d.filter(t=>t.name.includes(e)).length+1,n=i?"undead_spirit":e.toLowerCase(),l=e=>e.includes("(")?parseInt(e.split("(")[1])||10:parseInt(e.split(" ")[0])||10,c={id:crypto.randomUUID(),name:`${e} Spirit ${r}`,type:n,form:i?e.toLowerCase():void 0,hp:l(s.hp),maxHp:l(s.hp),ac:l(s.ac),speed:l(s.speed),attacks:s.actions.map(e=>{return{name:e.name,toHit:0,damage:(t=e.desc,t.match(/\d+d\d+(?:\s*[+-]\s*\d+)?/)?.[0]||"1d4"),damageType:e.desc.includes("necrotic")?"necrotic":e.desc.includes("slashing")?"slashing":"piercing"};var t}),conditions:[],controlExpiresRound:void 0,notes:s.traits?s.traits.map(e=>e.name).join(", "):""};o(a(c))};return e.jsx("div",{onClick:l,className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 transition-opacity "+(n?"pointer-events-auto":"pointer-events-none"),children:e.jsxs("div",{className:`fixed bottom-0 left-0 right-0 bg-card border-t border-white/20 rounded-t-3xl z-50 transition-transform duration-300 ease-out transform ${n?"translate-y-0":"translate-y-full"} h-[70vh] flex flex-col shadow-2xl shadow-white/5`,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-white/10 shrink-0",children:[e.jsx("div",{className:"w-12 h-1 bg-white/30 rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{size:20,className:"text-white"}),e.jsx("h2",{className:"font-display text-lg text-parchment-light tracking-wider",children:"Minion Manager"}),e.jsxs("span",{className:"bg-white/10 text-white text-xs px-2 py-0.5 rounded-full border border-white/20 font-display",children:[d.length," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.length>0&&e.jsx("button",{onClick:()=>{o(s())},className:"text-xs text-red-400 hover:text-red-300 uppercase font-display tracking-wider px-3 py-1.5 border border-red-400/30 rounded-lg hover:bg-red-400/10 transition-all","data-testid":"all-minions-clear-btn",children:"Release All"}),e.jsx("button",{onClick:l,className:"flex items-center justify-center w-10 h-10 rounded-full bg-white/5 border border-white/20 text-white/60 hover:text-white hover:bg-white/10 hover:border-white/40 transition-all","aria-label":"Close drawer",children:e.jsx(z,{size:20})})]})]})]}),e.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-4",children:[e.jsx("h3",{className:"text-xs text-muted uppercase tracking-widest font-bold mb-2",children:"Animate Dead"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>c("Skeleton"),className:"flex items-center justify-center gap-2 bg-card-elevated/80 hover:bg-card-elevated border border-white/10 hover:border-white/30 p-3 rounded-xl transition-all group","data-testid":"add-minion-skeleton-btn",children:[e.jsx(w,{size:18,className:"text-muted group-hover:text-white transition-colors"}),e.jsx("span",{className:"font-display text-sm text-parchment group-hover:text-parchment-light transition-colors",children:"Skeleton"})]}),e.jsxs("button",{onClick:()=>c("Zombie"),className:"flex items-center justify-center gap-2 bg-card-elevated/80 hover:bg-card-elevated border border-white/10 hover:border-white/30 p-3 rounded-xl transition-all group","data-testid":"add-minion-zombie-btn",children:[e.jsx(y,{size:18,className:"text-muted group-hover:text-white transition-colors"}),e.jsx("span",{className:"font-display text-sm text-parchment group-hover:text-parchment-light transition-colors",children:"Zombie"})]})]}),e.jsx("h3",{className:"text-xs text-muted uppercase tracking-widest font-bold mb-2",children:"Summon Undead (Tasha's)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>c("Ghostly"),className:"flex flex-col items-center justify-center gap-2 bg-blue-950/30 hover:bg-blue-900/40 border border-blue-500/20 hover:border-blue-400/40 p-3 rounded-xl transition-all group","data-testid":"add-minion-ghostly-btn",children:[e.jsx(w,{size:16,className:"text-blue-400/80 group-hover:text-blue-300 transition-colors"}),e.jsx("span",{className:"font-display text-xs text-blue-200/80 group-hover:text-blue-100 transition-colors",children:"Ghostly"})]}),e.jsxs("button",{onClick:()=>c("Putrid"),className:"flex flex-col items-center justify-center gap-2 bg-green-950/30 hover:bg-green-900/40 border border-green-500/20 hover:border-green-400/40 p-3 rounded-xl transition-all group","data-testid":"add-minion-putrid-btn",children:[e.jsx(y,{size:16,className:"text-green-400/80 group-hover:text-green-300 transition-colors"}),e.jsx("span",{className:"font-display text-xs text-green-200/80 group-hover:text-green-100 transition-colors",children:"Putrid"})]}),e.jsxs("button",{onClick:()=>c("Skeletal"),className:"flex flex-col items-center justify-center gap-2 bg-stone-800/50 hover:bg-stone-800 border border-stone-600/30 hover:border-stone-500/50 p-3 rounded-xl transition-all group","data-testid":"add-minion-skeletal-btn",children:[e.jsx(w,{size:16,className:"text-stone-400 group-hover:text-stone-300 transition-colors"}),e.jsx("span",{className:"font-display text-xs text-stone-300 group-hover:text-stone-200 transition-colors",children:"Skeletal"})]})]}),e.jsx(B,{minions:d,onUpdateMinion:(e,t)=>{o(r({id:e,changes:{hp:t}}))},onRemoveMinion:e=>{o(i(e))}})]}),e.jsx("div",{className:"h-4 shrink-0"})]})})}const Y=({icon:t,label:s,value:a,formula:i,color:r})=>{const[n,l]=N.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>i&&l(!n),className:`\n                    flex flex-col items-center p-2 rounded-lg transition-all\n                    bg-stone-900 border border-stone-800 hover:border-stone-700\n                    ${i?"cursor-pointer":"cursor-default"}\n                `,children:[e.jsx("div",{className:`${r} mb-1`,children:t}),e.jsx("div",{className:"text-xl font-bold text-stone-100",children:"number"==typeof a&&a>=0?`+${a}`:a}),e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-stone-500 font-bold",children:s})]}),n&&i&&e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 z-20 w-max max-w-48",children:e.jsx("div",{className:"bg-stone-800 border border-stone-700 rounded-lg p-3 shadow-xl text-xs text-stone-300",children:e.jsx("div",{className:"font-mono",children:i})})})]})},J=()=>{const t=n(l),s=n(d),a=n(e=>o(e,"int")),i=n(e=>e.character.profBonus);return e.jsx("div",{className:"bg-stone-950/80 backdrop-blur-md border-b border-stone-800 p-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-3 max-w-2xl mx-auto",children:[e.jsx(Y,{icon:e.jsx(P,{className:"w-4 h-4"}),label:"Spell Atk",value:t,formula:`= Prof (${i}) + INT (${a})`,color:"text-yellow-500"}),e.jsx("div",{className:"h-8 w-px bg-stone-800"}),e.jsx(Y,{icon:e.jsx(A,{className:"w-4 h-4"}),label:"Save DC",value:s,formula:`= 8 + Prof (${i}) + INT (${a})`,color:"text-blue-500"}),e.jsx("div",{className:"h-8 w-px bg-stone-800"}),e.jsx(Y,{icon:e.jsx($,{className:"w-4 h-4"}),label:"Prof",value:i,color:"text-green-500"}),e.jsx("div",{className:"h-8 w-px bg-stone-800"}),e.jsx(Y,{icon:e.jsx(M,{className:"w-4 h-4"}),label:"INT",value:a,color:"text-purple-500"})]})})};function K({slots:t,onUseSlot:s,onRestoreSlot:a}){const[i,r]=N.useState(null);return e.jsxs("div",{className:"card-parchment p-5 shadow-2xl shadow-bg-void/50 border border-white/5 relative overflow-hidden","data-testid":"pact-slots-display",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:18,className:"text-purp-bright"}),e.jsxs("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:["Pact Magic",t.length>0&&t[0].max>0&&e.jsxs("span",{className:"ml-2 text-purp-bright opacity-80 font-mono",children:["(",t[0].max-t[0].used,"/",t[0].max,")"]})]})]}),null!==i&&e.jsxs("button",{onClick:()=>r(null),className:"text-[10px] text-muted hover:text-white flex items-center gap-1 uppercase tracking-wide animate-fade-in",children:[e.jsx(z,{size:12})," Cancel"]})]}),e.jsx("div",{className:"space-y-6 relative z-10",children:t.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-2",children:[e.jsxs("div",{className:"text-xs text-muted uppercase tracking-widest font-mono",children:["Level ",t.level]}),e.jsx("div",{className:"text-[10px] text-gold-dim font-japanese opacity-50",children:"呪文枠"})]}),e.jsxs("div",{className:"flex gap-4",children:[Array.from({length:t.max}).map((a,n)=>{const l=n<t.used,d=i===t.level&&!l,o=!l;return e.jsxs("button",{onClick:()=>((e,t)=>{t&&(i===e?(s(e),r(null)):r(e))})(t.level,o),"data-testid":`pact-slot-orb-${n}`,disabled:l&&i!==t.level,className:`\n                                            relative w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300\n                                            ${l?"bg-bg-dark border border-white/5 opacity-50 cursor-not-allowed grayscale":"cursor-pointer hover:scale-110 active:scale-95"}\n                                            ${d?"bg-vermillion-ink border-2 border-vermillion shadow-[0_0_15px_rgba(255,100,100,0.5)] animate-pulse-fast":o?"bg-bg-ink border border-purp-dim shadow-inner":""}\n                                        `,children:[o&&!d&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purp-dim to-bg-void opacity-80"}),d&&e.jsx(I,{size:20,className:"text-white animate-ping-slow"}),l&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-bg-void inset-shadow-black"})]},n)}),t.used>0&&e.jsx("button",{onClick:()=>a(t.level),className:"ml-auto w-8 h-12 rounded-full border border-white/5 hover:border-gold-mid/30 flex items-center justify-center text-muted hover:text-gold-mid transition-all",title:"Restore Slot",children:e.jsx(T,{size:14})})]}),i===t.level&&e.jsx("div",{className:"mt-2 text-center text-[10px] text-vermillion font-bold uppercase tracking-widest animate-slide-up",children:"Tap again to Cast"})]},t.level))}),e.jsx("div",{className:"absolute -right-10 -bottom-10 w-40 h-40 bg-purp-dim/5 rounded-full blur-3xl pointer-events-none"})]})}function Q(e,t=Math.random){const s=e.replace(/\s+/g,"").toLowerCase();if(!s)throw new Error("Empty dice formula");if(!/^[0-9d+-]+$/.test(s))throw new Error(`Unsupported dice formula: "${e}"`);const a=s.match(/[+-]?[^+-]+/g)??[];if(0===a.length)throw new Error(`Unsupported dice formula: "${e}"`);let i=0;const r=[];for(const n of a){const e=n.startsWith("-")?-1:1,s=n.replace(/^[+-]/,"");if(s)if(s.includes("d")){const[a,l]=s.split("d"),d=a?Number.parseInt(a,10):1,o=Number.parseInt(l,10);if(!Number.isFinite(d)||!Number.isFinite(o)||d<=0||o<=0)throw new Error(`Invalid dice term: "${n}"`);const c=[];let m=0;for(let e=0;e<d;e++){const e=Math.floor(t()*o)+1;c.push(e),m+=e}i+=e*m;const x=`${e<0?"-":r.length?"+":""}${d}d${o}[${c.join(",")}]`;r.push(x)}else{const t=Number.parseInt(s,10);if(!Number.isFinite(t))throw new Error(`Invalid numeric term: "${n}"`);i+=e*t;const a=`${e<0?"-":r.length?"+":""}${t}`;r.push(a)}}return{formula:s,total:i,detail:`${r.join(" ")} = ${i}`}}const V=["Prone","Poisoned","Frightened","Grappled","Restrained","Invisible","Stunned","Paralyzed"];function X(){const s=t(),a=n(c),i=n(e=>e.combat),r=n(e=>m.selectAll(e.combat.minions)),[l,d]=N.useState(""),[o,k]=N.useState(""),[C,S]=N.useState(""),[P,A]=N.useState(""),[$,M]=N.useState(""),[I,T]=N.useState(!1),[q,B]=N.useState(null),[Y,X]=N.useState(!1),[ee,te]=N.useState(null),se=N.useMemo(()=>Object.entries(a.slots).map(([e,t])=>({level:Number(e),...t})),[a.slots]),ae=r.filter(e=>e.type.toLowerCase().includes("skeleton")).length,ie=r.filter(e=>e.type.toLowerCase().includes("zombie")).length,re=(e,t)=>{s(u({type:"note",title:e,detail:t}))},ne=e=>{const t=e.trim();t&&(s(v(t)),re(`Condition: ${t}`),A(""))},le=e=>{const t=O.find(t=>t.name.includes(e));t&&B(t)};return e.jsxs("div",{className:"pb-20 space-y-4 animate-fade-in",children:[e.jsx("div",{className:"mb-4 shadow-lg sticky top-0 z-20",children:e.jsx(J,{})}),e.jsxs("div",{className:"card-parchment p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:18,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:"Combat Mode"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted -mt-1 opacity-50 tracking-widest",children:"戦闘モード"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-card-elevated/80 p-3 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider mb-1",children:"Round"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-white"}),e.jsx("span",{className:"text-white text-lg font-display",children:i.currentRound})]})]}),e.jsxs("div",{className:"bg-card-elevated/80 p-3 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider mb-1",children:"Turn"}),e.jsx("div",{className:"text-white text-sm",children:i.currentTurnIndex})]})]})]}),e.jsxs("div",{className:"card-parchment p-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-card-elevated/80 p-3 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:"HP"}),e.jsxs("div",{className:"text-lg font-display text-white","data-testid":"hp-current-display",children:[e.jsx("span",{"data-testid":"hp-current",children:a.hp.current}),"/",e.jsx("span",{"data-testid":"hp-max",children:a.hp.max})]})]}),e.jsxs("div",{className:"bg-card-elevated/80 p-3 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:"Temp"}),e.jsx("div",{className:"text-lg font-display text-parchment-light","data-testid":"hp-temp-display",children:a.hp.temp})]}),e.jsxs("div",{className:"bg-card-elevated/80 p-3 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:"AC"}),e.jsx("div",{className:"text-lg font-display text-white",children:a.baseAC+a.abilityMods.dex+(a.mageArmour?3:0)+(a.shield?5:0)})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:0,placeholder:"Damage",className:"flex-1 bg-white/5 border border-white/10 rounded-md px-3 py-2 text-sm text-white placeholder:text-muted",value:l,onChange:e=>d(e.target.value),"data-testid":"hp-damage-input"}),e.jsx("button",{className:"btn-primary px-4",onClick:()=>{const e=Number(l);!Number.isFinite(e)||e<=0||(s(b(a.hp.current-e)),re(`Took ${e} damage`),d(""))},"data-testid":"hp-decrease-btn",children:"Take"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:0,placeholder:"Heal",className:"flex-1 bg-white/5 border border-white/10 rounded-md px-3 py-2 text-sm text-white placeholder:text-muted",value:o,onChange:e=>k(e.target.value),"data-testid":"hp-heal-input"}),e.jsx("button",{className:"btn-primary px-4",onClick:()=>{const e=Number(o);!Number.isFinite(e)||e<=0||(s(b(a.hp.current+e)),re(`Healed ${e} HP`),k(""))},"data-testid":"hp-increase-btn",children:"Heal"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:0,placeholder:"Temp HP",className:"flex-1 bg-white/5 border border-white/10 rounded-md px-3 py-2 text-sm text-white placeholder:text-muted",value:C,onChange:e=>S(e.target.value),"data-testid":"hp-temp-input"}),e.jsx("button",{className:"btn-primary px-4",onClick:()=>{const e=Number(C);!Number.isFinite(e)||e<0||(s(g(e)),re(`Temp HP set to ${e}`),S(""))},"data-testid":"hp-temp-set-btn",children:"Set"})]})]})]}),e.jsxs("div",{className:"card-parchment p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:18,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:"Conditions"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted -mt-1 opacity-50 tracking-widest",children:"状態"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.conditions.map(t=>e.jsx("button",{onClick:()=>s(x(t)),className:"px-3 py-1 rounded-full text-xs uppercase tracking-wider bg-amber-500/10 text-amber-200 border border-amber-400/30",children:t},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Custom Condition",className:"flex-1 bg-white/5 border border-white/10 rounded-md px-3 py-2 text-sm text-white",value:P,onChange:e=>A(e.target.value)}),e.jsx("button",{className:"btn-primary px-4",onClick:()=>ne(P),children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(t=>e.jsx("button",{onClick:()=>ne(t),className:"px-3 py-3 rounded-full text-[10px] uppercase tracking-wider bg-white/5 text-muted border border-white/10 hover:border-white/30 flex items-center justify-center min-h-[48px]",children:t},t))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{slots:se,onUseSlot:e=>{const t=a.slots[e];!t||t.used>=t.max||(s(f({level:e})),re(`Used level ${e} slot`))},onRestoreSlot:e=>{const t=a.slots[e];!t||t.used<=0||(s(j({level:e})),re(`Restored level ${e} slot`))}}),e.jsxs("div",{className:"card-parchment p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:18,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:"Action Economy"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted -mt-1 opacity-50 tracking-widest",children:"行動数"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:"px-3 py-2 rounded-md text-xs uppercase tracking-wider border "+(i.reactionAvailable?"bg-emerald-500/20 text-emerald-200 border-emerald-400/40":"bg-white/5 text-muted border-white/10"),onClick:()=>s(h()),children:["Reaction ",i.reactionAvailable?"Ready":"Spent"]}),e.jsxs("button",{className:"px-3 py-2 rounded-md text-xs uppercase tracking-wider border "+(i.bonusActionAvailable?"bg-emerald-500/20 text-emerald-200 border-emerald-400/40":"bg-white/5 text-muted border-white/10"),onClick:()=>s(p()),children:["Bonus ",i.bonusActionAvailable?"Ready":"Spent"]})]})]})]}),e.jsxs("div",{className:"card-parchment p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:18,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:"Combat Log"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted -mt-1 opacity-50 tracking-widest",children:"戦闘記録"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Quick note",className:"flex-1 bg-white/5 border border-white/10 rounded-md px-3 py-2 text-sm text-white",value:$,onChange:e=>M(e.target.value)}),e.jsx("button",{className:"btn-primary px-4",onClick:()=>{$.trim()&&(s(u({type:"note",title:$})),M(""))},children:"Log"})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:i.log.slice(0,50).map(t=>e.jsxs("div",{className:"bg-card-elevated/70 border border-white/10 rounded-lg p-3",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsx("div",{className:"text-sm text-parchment-light",children:t.title}),t.detail&&e.jsx("div",{className:"text-xs text-muted mt-1",children:t.detail})]},t.id))})]}),e.jsxs("div",{className:"card-parchment p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:18,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:"Undead Horde"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted -mt-1 opacity-50 tracking-widest",children:"不死の軍勢"})]})]}),e.jsxs("span",{className:"text-xs text-white font-display",children:[r.length," Active"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4 relative z-10",children:[e.jsxs("div",{className:"bg-card-elevated/80 p-4 rounded-lg border border-white/10 text-center relative group cursor-pointer hover:border-white/30 transition-all",onClick:()=>le("Skeleton"),"data-testid":"skeleton-counter",children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(F,{size:12,className:"text-white"})}),e.jsxs("div",{className:"relative w-12 h-12 mx-auto mb-2 flex items-center justify-center",children:[e.jsx("img",{src:"/Fuyuki/assets/minion-bubble.png",alt:"",className:"absolute inset-0 w-full h-full object-contain opacity-80"}),e.jsx(w,{size:20,className:"relative z-10 text-parchment group-hover:text-white transition-colors"})]}),e.jsx("div",{className:"text-2xl font-display text-parchment-light mb-1",children:ae}),e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:"Skeletons"})]}),e.jsxs("div",{className:"bg-card-elevated/80 p-4 rounded-lg border border-white/10 text-center relative group cursor-pointer hover:border-white/30 transition-all",onClick:()=>le("Zombie"),"data-testid":"zombie-counter",children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(F,{size:12,className:"text-white"})}),e.jsxs("div",{className:"relative w-12 h-12 mx-auto mb-2 flex items-center justify-center",children:[e.jsx("img",{src:"/Fuyuki/assets/minion-bubble.png",alt:"",className:"absolute inset-0 w-full h-full object-contain opacity-80"}),e.jsx(y,{size:20,className:"relative z-10 text-parchment group-hover:text-white transition-colors"})]}),e.jsx("div",{className:"text-2xl font-display text-parchment-light mb-1",children:ie}),e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:"Zombies"})]})]}),e.jsxs("button",{onClick:()=>T(!0),className:"w-full btn-primary flex items-center justify-center gap-2 relative z-10","data-testid":"manage-horde-btn",children:[e.jsx(w,{size:16}),"Manage Horde"]})]}),e.jsxs("div",{className:"card-parchment p-4",children:[e.jsxs("button",{className:"flex items-center justify-between w-full mb-2",onClick:()=>X(!Y),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:18,className:"text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider uppercase",children:"Summon Undead"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted -mt-1 opacity-50 tracking-widest",children:"アンデッド召喚"})]})]}),Y?e.jsx(G,{size:16,className:"text-muted"}):e.jsx(Z,{size:16,className:"text-muted"})]}),Y&&e.jsxs("div",{className:"space-y-2 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-card-elevated/60 border border-white/10 cursor-pointer",onClick:()=>le("Ghostly"),children:[e.jsx(W,{size:18,className:"text-parchment"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-display text-parchment-light",children:"Ghostly"}),e.jsx("div",{className:"text-xs text-muted",children:"Fly 40ft • 1d8+7 Necrotic"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-card-elevated/60 border border-white/10 cursor-pointer",onClick:()=>le("Putrid"),children:[e.jsx(L,{size:18,className:"text-parchment"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-display text-parchment-light",children:"Putrid"}),e.jsx("div",{className:"text-xs text-muted",children:"Poison Aura • 1d6+7 Slash"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-card-elevated/60 border border-white/10 cursor-pointer",onClick:()=>le("Skeletal"),children:[e.jsx(R,{size:18,className:"text-parchment"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-display text-parchment-light",children:"Skeletal"}),e.jsx("div",{className:"text-xs text-muted",children:"Ranged 150ft • 2d4+7 Necrotic"})]})]})]})]}),e.jsx(_,{isOpen:I,onClose:()=>T(!1),minions:r}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:()=>B(null),"data-testid":"stat-block-modal",children:e.jsxs("div",{className:"card-parchment w-full max-w-md max-h-[85vh] flex flex-col shadow-2xl shadow-white/5 animate-scale-in",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start p-4 border-b border-white/10 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-display text-parchment-light",children:q.name}),e.jsx("p",{className:"text-xs text-muted italic",children:q.type})]}),e.jsx("button",{onClick:()=>B(null),children:e.jsx(z,{size:20,className:"text-white/60 hover:text-white"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto flex-1 text-sm space-y-4",children:[ee&&e.jsxs("div",{className:"bg-white/10 border border-white/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-[10px] text-muted uppercase tracking-wider mb-1",children:ee.label}),e.jsx("div",{className:"font-display text-parchment-light",children:ee.detail})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center bg-card-elevated/80 p-3 rounded-lg border border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-muted uppercase",children:"AC"}),e.jsx("div",{className:"font-display text-lg text-white",children:q.ac})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-muted uppercase",children:"HP"}),e.jsx("div",{className:"font-display text-lg text-white",children:q.hp})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-muted uppercase",children:"SPD"}),e.jsx("div",{className:"font-display text-lg text-white",children:q.speed})]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-1 text-center text-xs",children:Object.entries(q.stats).map(([t,s])=>e.jsxs("div",{className:"bg-card-elevated p-2 rounded border border-white/10",children:[e.jsx("div",{className:"text-[8px] text-muted uppercase",children:t}),e.jsx("div",{className:"font-display text-parchment-light",children:s})]},t))}),e.jsxs("div",{className:"border-t border-white/10 pt-3",children:[e.jsx("h4",{className:"text-white font-display border-b border-white/10 pb-1 mb-2",children:"Actions"}),q.actions.map(t=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"text-parchment-light font-display italic",children:[t.name,"."]})," ",e.jsx("span",{className:"text-parchment",children:t.desc}),(()=>{const s=function(e){const t=e.match(/\+\s*(\d+)\s*to hit/i);if(!t)return null;const s=Number.parseInt(t[1],10);return Number.isFinite(s)?s:null}(t.desc),a=function(e){const t=e.match(/Hit:\s*[^()]*\(([^)]+)\)/i);if(t?.[1])return t[1].replace(/\s+/g,"");const s=e.match(/Hit:\s*([0-9]+d[0-9]+(?:\s*[+-]\s*\d+)*)/i);return s?.[1]?s[1].replace(/\s+/g,""):null}(t.desc);return s||a?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[null!=s&&e.jsxs("button",{className:"rounded-xl px-4 py-2 bg-white/10 hover:bg-white/15 border border-white/10 text-xs",onClick:()=>{const e=Q(`1d20+${s}`);te({label:`${t.name} Attack`,detail:e.detail})},children:["Attack (+",s,")"]}),a&&e.jsxs("button",{className:"rounded-xl px-4 py-2 bg-white/10 hover:bg-white/15 border border-white/10 text-xs",onClick:()=>{const e=Q(a);te({label:`${t.name} Damage`,detail:e.detail})},children:["Damage (",a,")"]})]}):null})()]},t.name))]})]})]})})]})}export{X as CombatView};
