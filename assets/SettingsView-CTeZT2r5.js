import{T as e,j as t}from"./index-tQUpmkV-.js";import{r as s}from"./react-vendor-D-3wKq8v.js";import{J as a,v as i,w as n,d as c,P as r,O as l,H as d,Q as o,X as x,V as m,c as h,z as p,Y as u}from"./ui-vendor-CrPKbo4G.js";import{CharacterHubView as j}from"./CharacterHubView-BxIuP09c.js";import"./redux-vendor-CafaKUJ8.js";import"./GrimoireView-DrWXy_NQ.js";e.number().int().min(1).max(9999);const b=e.number().int().min(3).max(30),v=e.number().int().min(1).max(20);function N(e){const t=parseInt(String(e))||10;return b.parse(t)}function f(e){const t=parseInt(String(e))||1;return v.parse(t)}const g={str:"Strength",dex:"Dexterity",con:"Constitution",int:"Intelligence",wis:"Wisdom",cha:"Charisma"};function w({data:e,onLevelChange:l,onAbilityChange:d}){const[o,x]=s.useState(!1),m=t=>{const s=f(e.level+t);s!==e.level&&l(s)},h=(t,s)=>{const a=N(e.abilities[t]+s);a!==e.abilities[t]&&d(t,a)};return t.jsxs("div",{className:"card-parchment p-4 mb-4",children:[t.jsxs("button",{onClick:()=>x(!o),className:"w-full flex items-center justify-between","data-testid":"character-editor-toggle",children:[t.jsxs("div",{className:"flex items-center gap-2 text-accent",children:[t.jsx(a,{size:18}),t.jsx("h3",{className:"text-sm font-kyoto uppercase tracking-widest",children:"Character Settings"})]}),o?t.jsx(i,{size:18}):t.jsx(n,{size:18})]}),o&&t.jsxs("div",{className:"mt-4 space-y-4 animate-scale-in",children:[t.jsxs("div",{className:"flex items-center justify-between bg-white/5 p-3 rounded-lg border border-white/10",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"label-kyoto mb-0",children:"Character Level"}),t.jsx("span",{className:"text-[10px] text-accent/60 font-display",children:"総レベル"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>m(-1),className:"p-1 hover:text-accent","data-testid":"level-decrease-btn",children:t.jsx(c,{size:16})}),t.jsx("input",{type:"number",value:e.level,onChange:e=>(e=>{const t=f(parseInt(e)||1);l(t)})(e.target.value),className:"w-16 text-center input-kyoto font-display","data-testid":"level-input"}),t.jsx("button",{onClick:()=>m(1),className:"p-1 hover:text-accent","data-testid":"level-increase-btn",children:t.jsx(r,{size:16})})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(g).map(s=>t.jsxs("div",{className:"bg-white/5 p-2 rounded border border-white/10",children:[t.jsx("span",{className:"label-kyoto text-[10px] mb-1",children:g[s]}),t.jsxs("div",{className:"flex items-center justify-between gap-1",children:[t.jsx("input",{type:"number",value:e.abilities[s],onChange:e=>((e,t)=>{const s=N(parseInt(t)||1);d(e,s)})(s,e.target.value),className:"w-12 text-center input-kyoto font-display text-sm p-1","data-testid":`ability-${s}-input`}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("button",{onClick:()=>h(s,1),className:"p-0.5 hover:text-accent","data-testid":`ability-${s}-increase-btn`,children:t.jsx(i,{size:12})}),t.jsx("button",{onClick:()=>h(s,-1),className:"p-0.5 hover:text-accent","data-testid":`ability-${s}-decrease-btn`,children:t.jsx(n,{size:12})})]})]})]},s))}),t.jsx("div",{className:"mt-4 pt-3 border-t border-white/10 text-center",children:t.jsx("p",{className:"text-[10px] text-muted italic",children:"Changes auto-save and cascade to derived stats per SRD 5.1"})})]})]})}function y({hitDice:e,conMod:a,currentHP:i,maxHP:n,onSpend:c}){const[r,o]=s.useState(null),x=e.current>0&&i<n;return t.jsxs("div",{className:"card-parchment p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(l,{size:18,className:"text-white"}),t.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider",children:"Hit Dice"})]}),t.jsxs("span",{className:"text-xs "+(0===e.current?"text-red-400":"text-muted"),children:[t.jsx("span",{"data-testid":"hit-dice-available",children:e.current}),"/",t.jsx("span",{"data-testid":"hit-dice-total",children:e.max})," d",e.size]})]}),t.jsx("div",{className:"flex items-center gap-2 mb-4",children:Array.from({length:e.max}).map((s,a)=>{const i=a<e.current;return t.jsxs("div",{className:"w-8 h-8 rounded-lg border-2 flex items-center justify-center text-xs font-display transition-all "+(i?"bg-white/10 border-white/30 text-white":"bg-transparent border-white/10 text-muted"),"data-testid":`hit-die-orb-${a}`,children:["d",e.size]},a)})}),r&&t.jsx("div",{className:"bg-white/10 border border-white/20 rounded-lg p-3 mb-3 animate-scale-in","data-testid":"hit-dice-roll-display",children:t.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.jsx("span",{className:"text-muted text-sm",children:"Rolled"}),t.jsx("span",{className:"font-display text-2xl text-white",children:r.roll}),t.jsxs("span",{className:"text-muted text-sm",children:["+ ",a," CON ="]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(d,{size:16,className:"text-white"}),t.jsx("span",{className:"font-display text-2xl text-white",children:r.total})]})]})}),t.jsxs("button",{onClick:()=>{if(!x)return;const t=Math.floor(Math.random()*e.size)+1,s=Math.max(0,t+a),r=Math.min(s,n-i);o({roll:t,total:s}),c(r,1),setTimeout(()=>o(null),3e3)},disabled:!x,className:"w-full btn-fantasy py-3 flex items-center justify-center gap-2 "+(x?"":"opacity-50 cursor-not-allowed"),"data-testid":"spend-hit-die-btn",children:[t.jsx(l,{size:16}),i>=n?"HP Full":0===e.current?"No Hit Dice":"Spend Hit Die"]}),t.jsxs("p",{className:"text-[10px] text-muted mt-2 text-center opacity-60",children:["Roll d",e.size," + ",a," CON mod to heal"]})]})}function k({hitDice:e,conMod:a,currentHP:i,maxHP:n,onSpendHitDie:c,onShortRest:r,onLongRest:l,compact:d=!1}){const[j,b]=s.useState(!1);return j?t.jsxs("div",{className:d?"":"pb-20",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(o,{size:24,className:"text-white"}),t.jsx("h2",{className:"font-display text-xl text-parchment-light tracking-wider",children:"Short Rest"})]}),t.jsx("button",{onClick:()=>b(!1),className:"p-2 text-muted hover:text-white transition-colors",children:t.jsx(x,{size:20})})]}),t.jsxs("div",{className:"card-parchment p-4 mb-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted",children:"Current HP"}),t.jsxs("span",{className:"font-display text-xl text-white",children:[i," ",t.jsxs("span",{className:"text-muted",children:["/ ",n]})]})]}),t.jsx("div",{className:"h-2 bg-card-elevated rounded-full overflow-hidden mt-2 border border-white/10",children:t.jsx("div",{className:"h-full bg-white transition-all duration-300",style:{width:i/n*100+"%"}})})]}),t.jsx("div",{"data-testid":"hit-dice-display",children:t.jsx(y,{hitDice:e,conMod:a,currentHP:i,maxHP:n,onSpend:c})}),t.jsxs("div",{className:"mt-8 flex flex-col gap-4",children:[t.jsx("button",{onClick:()=>{r(),b(!1)},className:"w-full btn-primary-action p-4 text-center","data-testid":"finish-short-rest-btn",children:t.jsx("span",{className:"font-kyoto uppercase tracking-[0.2em]",children:"Finish Short Rest"})}),t.jsx("p",{className:"text-xs text-muted text-center opacity-60",children:"Pact Slots will be refilled upon finishing the rest."})]})]}):t.jsxs("div",{className:(d?"py-4":"pb-20 min-h-[60vh]")+" flex flex-col items-center justify-center h-full",children:[t.jsxs("div",{className:"text-center mb-10",children:[t.jsxs("div",{className:"relative inline-block mb-4",children:[t.jsx(m,{size:48,className:"text-parchment"}),t.jsx(h,{size:16,className:"text-white absolute -top-1 -right-1 animate-pulse"})]}),t.jsx("h2",{className:"font-display text-2xl text-parchment-light tracking-wider mb-2",children:"Rest & Recovery"}),t.jsx("p",{className:"text-sm text-muted max-w-xs mx-auto",children:"Choose a rest type to recover hit points and spell slots."})]}),t.jsxs("div",{className:"w-full space-y-4",children:[t.jsx("button",{onClick:()=>b(!0),className:"w-full card-parchment p-5 text-left group transition-all hover:shadow-accent-subtle","data-testid":"short-rest-btn",children:t.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[t.jsx("div",{className:"p-3 bg-card-elevated rounded-full border border-accent/10 group-hover:border-accent/30 transition-colors",children:t.jsx(o,{size:24,className:"text-accent group-hover:text-white transition-colors"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-kyoto text-lg text-parchment group-hover:text-white transition-colors tracking-widest uppercase",children:"Short Rest"}),t.jsxs("p",{className:"text-[10px] text-muted uppercase tracking-widest",children:["Spend Hit Dice to heal • ",e.current,"/",e.max," available"]})]}),t.jsx(p,{size:20,className:"text-muted group-hover:text-white transition-colors"})]})}),t.jsx("button",{onClick:()=>{confirm("Take a Long Rest? This will reset HP, Pact Slots, Invocations, and recover Hit Dice.")&&l()},className:"w-full card-parchment p-5 text-left group transition-all hover:shadow-accent-md","data-testid":"long-rest-btn",children:t.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[t.jsx("div",{className:"p-3 bg-card-elevated rounded-full border border-accent/10 group-hover:border-accent/30 transition-colors",children:t.jsx(u,{size:24,className:"text-accent group-hover:text-white transition-colors"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-kyoto text-lg text-parchment group-hover:text-white transition-colors tracking-widest uppercase",children:"Long Rest"}),t.jsx("p",{className:"text-[10px] text-muted uppercase tracking-widest",children:"Full HP, Pact Slots, Invocations, ½ Hit Dice"})]}),t.jsx(p,{size:20,className:"text-muted group-hover:text-white transition-colors"})]})})]})]})}function C({character:e,actions:s,onLevelChange:a,onAbilityChange:i,onSpendHitDie:n,onShortRest:c,onLongRest:r}){return t.jsxs("div",{className:"animate-fade-in space-y-8 pb-24",children:[t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 px-2",children:[t.jsx("div",{className:"h-px bg-white/10 flex-1"}),t.jsx("h2",{className:"text-xs font-kyoto uppercase tracking-[0.2em] text-muted",children:"Core Stats"}),t.jsx("div",{className:"h-px bg-white/10 flex-1"})]}),t.jsx(w,{data:e,onLevelChange:a,onAbilityChange:i})]}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 px-2",children:[t.jsx("div",{className:"h-px bg-white/10 flex-1"}),t.jsx("h2",{className:"text-xs font-kyoto uppercase tracking-[0.2em] text-muted",children:"Rest & Recovery"}),t.jsx("div",{className:"h-px bg-white/10 flex-1"})]}),t.jsx("div",{className:"bg-white/5 rounded-lg border border-white/5 p-4 relative overflow-hidden",children:t.jsx(k,{hitDice:e.hitDice,conMod:e.abilityMods.con,currentHP:e.hp.current,maxHP:e.hp.max,onSpendHitDie:n,onShortRest:c,onLongRest:r,compact:!0})})]}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 px-2",children:[t.jsx("div",{className:"h-px bg-white/10 flex-1"}),t.jsx("h2",{className:"text-xs font-kyoto uppercase tracking-[0.2em] text-muted",children:"Details"}),t.jsx("div",{className:"h-px bg-white/10 flex-1"})]}),t.jsx(j,{character:e,actions:s})]})]})}export{C as SettingsView};
