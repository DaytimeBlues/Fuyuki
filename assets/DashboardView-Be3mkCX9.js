import{j as e,u as t,a as s,s as a,p as r,b as i,c as n,d as l,e as c,f as d,g as o,h as x}from"./index-tQUpmkV-.js";import{r as m,R as p}from"./react-vendor-D-3wKq8v.js";import{S as h,d as u,P as b,b as g,W as j,I as f,c as N,E as v,X as w,H as y}from"./ui-vendor-CrPKbo4G.js";import"./redux-vendor-CafaKUJ8.js";const k=m.memo(function({current:t,max:s,temp:a,onChange:r,onTempChange:i}){const[n,l]=m.useState(""),[c,d]=m.useState(!1),[o,x]=m.useState(!1),[p,j]=m.useState(0),f=m.useMemo(()=>Math.min(100,Math.max(0,t/s*100)),[t,s]),N=0===t,v=t<=10&&t>0,w=t>0&&t<=.25*s,y=e=>{j(e=>e+1),e<t?(d(!0),x(!1),setTimeout(()=>d(!1),400)):e>t&&(x(!0),d(!1),setTimeout(()=>x(!1),400)),r(e)},k=m.useCallback(()=>{const e=parseInt(n)||0;e>a&&i(e),l("")},[n,a,i]),C=m.useCallback(()=>i(0),[i]);return e.jsxs("div",{className:`card-parchment p-4 mb-4 transition-all duration-300 ${c?"damage-taken":""} ${w?"animate-shake shadow-[0_0_20px_rgba(255,0,0,0.3)] border-vermillion/50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(h,{size:18,className:"text-white"}),e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider",children:"Hit Points"}),e.jsx("span",{className:"text-[10px] bg-white/5 px-2 py-0.5 rounded-full text-white/40 font-display tracking-tighter border border-white/10","data-testid":"app-ready",children:"ヒットポイント"}),a>0&&e.jsxs("span",{className:"ml-auto text-xs bg-white/10 text-white px-2 py-0.5 rounded-full border border-white/20","data-testid":"hp-temp-display",children:["+",a," THP"]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`stat-circle ${N?"border-red-500":""} ${v?"border-orange-500":""}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:`font-display text-2xl ${N?"text-red-400":w?"text-vermillion-light font-bold":v?"text-orange-400":"text-parchment-light"} ${c?"animate-number-pop-damage":o?"animate-number-pop-heal":""}`,"data-testid":"hp-current",children:t},p),e.jsxs("span",{className:"text-muted text-sm","data-testid":"hp-max",children:["/",s]})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-2 bg-card-elevated rounded-full overflow-hidden mb-3 border border-white/10",children:e.jsx("div",{className:"h-full transition-all duration-300 ease-out rounded-full "+(N?"bg-red-500":v?"bg-orange-500":"bg-white"),style:{width:`${f}%`}})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(t-1),className:"btn-fantasy flex-1 flex flex-col items-center justify-center py-2 h-14 active:bg-red-900/30 active:border-red-500/50 transition-colors","data-testid":"hp-decrease-btn",children:[e.jsx(u,{size:20,className:"mb-0.5"}),e.jsx("span",{className:"text-[8px] font-display text-muted uppercase tracking-widest leading-none",children:"Damage"})]}),e.jsxs("button",{onClick:()=>y(t+1),className:"btn-fantasy flex-1 flex flex-col items-center justify-center py-2 h-14 active:bg-green-900/30 active:border-green-500/50 transition-colors","data-testid":"hp-increase-btn",children:[e.jsx(b,{size:20,className:"mb-0.5"}),e.jsx("span",{className:"text-[8px] font-display text-muted uppercase tracking-widest leading-none",children:"Heal"})]})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{size:14,className:"text-white/70"}),e.jsx("span",{className:"text-xs text-muted",children:"Temp HP"}),e.jsx("input",{type:"number",min:"0",value:n,onChange:e=>l(e.target.value),placeholder:a.toString(),className:"flex-1 bg-card-elevated border border-white/10 rounded px-2 py-1 text-sm text-parchment w-16 text-center focus:outline-none focus:border-white/30","data-testid":"hp-temp-input"}),e.jsx("button",{onClick:k,className:"btn-fantasy text-xs px-2 py-1","data-testid":"hp-temp-set-btn",children:"Set"}),a>0&&e.jsx("button",{onClick:C,className:"text-xs text-red-400 hover:text-red-300 border border-red-500/30 px-2 py-1 rounded bg-red-900/20","data-testid":"hp-temp-clear-btn",children:"Clear"})]}),e.jsx("p",{className:"text-[10px] text-muted mt-1 opacity-60",children:"THP replaces (doesn't stack) • Absorbed before HP"})]})]})}),C=()=>{const n=t(),{current:l,max:c,level:d}=s(a),[o,x]=p.useState(!1),m=()=>{l>0&&n(i())},h=e=>{e.stopPropagation(),l<c&&n(r())};return e.jsxs("div",{className:"card-parchment p-4 flex flex-col gap-3 relative",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-accent",children:[e.jsx(j,{size:18}),e.jsx("h3",{className:"text-sm font-kyoto uppercase tracking-widest",children:"Pact Magic"}),e.jsx("button",{onClick:()=>x(!o),className:"text-muted hover:text-white transition-colors ml-1","aria-label":"Pact Magic Info",children:e.jsx(f,{size:12})}),o&&e.jsxs("div",{className:"absolute top-10 left-4 bg-stone-900 border border-stone-600 p-2 rounded text-[10px] text-stone-300 w-48 z-10 shadow-xl animate-in fade-in zoom-in-95",children:["Pact Magic slots recover on a Short Rest. They are always cast at level ",d,"."]})]}),e.jsxs("span",{className:"text-xs font-medium text-muted",children:["Level ",d]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 py-1 justify-start",children:Array.from({length:c}).map((t,s)=>{const a=s>=l;return e.jsx("button",{className:"w-12 h-12 flex items-center justify-center rounded-full hover:bg-white/5 active:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-accent/50 group",onClick:a?h:m,"aria-label":a?"Restore Pact Slot":"Use Pact Slot","data-testid":`pact-slot-btn-${s}`,children:e.jsx("div",{className:"orb transition-all duration-300 "+(a?"orb-empty scale-90 opacity-50":"animate-pulse-glow group-hover:scale-110"),"data-testid":`pact-slot-orb-${s}`})},s)})}),e.jsxs("div",{className:"flex items-center justify-between mt-1 px-1",children:[e.jsxs("span",{className:"text-2xl font-display font-bold text-text-bright","data-testid":"pact-slots-display",children:[l,e.jsx("span",{className:"text-lg text-muted mx-1",children:"/"}),c]}),e.jsx("span",{className:"text-[10px] text-muted uppercase tracking-tighter",children:0===l?"Short Rest needed":"Tap orb to cast"})]})]})},S=()=>{const a=t(),r=s(n),{level:i}=s(l);if(i<11)return null;const o=[6,7,8,9].filter(e=>6===e?i>=11:7===e?i>=13:8===e?i>=15:9===e&&i>=17);return e.jsxs("div",{className:"card-parchment p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-accent",children:[e.jsx(N,{size:18}),e.jsx("h3",{className:"text-sm font-kyoto uppercase tracking-widest",children:"Mystic Arcanum"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:o.map(t=>{const s=r[t],i=s?.used??!1;return e.jsxs("button",{onClick:()=>a(i?c(t):d(t)),className:"flex items-center justify-between p-2 rounded border transition-all "+(i?"bg-bg-dark border-transparent text-muted":"bg-card-elevated border-accent/20 text-text hover:border-accent/50"),"data-testid":`arcanum-${t}`,children:[e.jsxs("span",{className:"text-xs font-bold",children:[t,"th"]}),e.jsx("div",{className:"w-2 h-2 rounded-full "+(i?"bg-bg":"bg-accent shadow-accent-sm"),"data-testid":`arcanum-orb-${t}`})]},t)})})]})},z=["Bless","Hex","Hunter's Mark","Haste","Fly","Invisibility","Hold Person","Animate Dead","Spirit Guardians"];function P({spell:t,suggestions:s=z,onClear:a,onSet:r}){return e.jsxs("div",{className:"card-parchment p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:18,className:t?"text-white":"text-muted"}),e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider",children:"Concentration"})]}),t&&e.jsxs("button",{onClick:a,className:"text-xs text-red-400 hover:text-red-300 flex items-center gap-1","data-testid":"concentration-clear-btn",children:[e.jsx(w,{size:12}),"End"]})]}),t?e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white animate-pulse"}),e.jsx("span",{className:"text-sm text-white font-display","data-testid":"concentration-spell",children:t})]})})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-muted",children:"Not concentrating on any spell"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.slice(0,4).map(t=>e.jsx("button",{onClick:()=>r(t),className:"text-[10px] px-2 py-1 bg-card-elevated border border-white/10 rounded text-muted hover:text-white hover:border-white/30 transition-colors","data-testid":`concentration-set-btn-${t.toLowerCase().replace(/\s+/g,"-")}`,children:t},t))})]}),t&&e.jsx("p",{className:"text-[10px] text-muted mt-2 opacity-60",children:"Taking damage requires CON save (DC 10 or ½ damage)"})]})}function H({successes:t,failures:s,onChange:a}){return e.jsxs("div",{className:"card-parchment p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(h,{size:18,className:"text-muted"}),e.jsx("h3",{className:"font-display text-sm text-parchment tracking-wider",children:"Death Saves"})]}),e.jsxs("div",{className:"flex justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3","data-testid":"death-successes",children:[e.jsx(y,{size:14,className:"text-white"}),e.jsx("span",{className:"text-xs text-white uppercase tracking-wider",children:"Success"})]}),e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(s=>e.jsx("button",{onClick:()=>a("successes",s===t?s-1:s),className:"w-7 h-7 rounded-full border-2 transition-all duration-200 "+(s<=t?"bg-white border-white shadow-[0_0_10px_rgba(255,255,255,0.3)]":"bg-transparent border-white/30 hover:border-white/50"),"data-testid":"death-success-"+(s-1)},s))})]}),e.jsx("div",{className:"w-px bg-white/10"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3","data-testid":"death-failures",children:[e.jsx(h,{size:14,className:"text-red-400"}),e.jsx("span",{className:"text-xs text-red-400 uppercase tracking-wider",children:"Failure"})]}),e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(t=>e.jsx("button",{onClick:()=>a("failures",t===s?t-1:t),className:"w-7 h-7 rounded-full border-2 transition-all duration-200 "+(t<=s?"bg-red-500 border-red-500 shadow-[0_0_10px_rgba(239,68,68,0.4)]":"bg-transparent border-white/30 hover:border-red-500/50"),"data-testid":"death-failure-"+(t-1)},t))})]})]})]})}function $({character:s,updateHealth:a,updateTempHP:r,updateDeathSaves:i}){const n=t(),l=o.filter(e=>e.concentration).filter(e=>{return((t=e.lvl)<=0?1:Math.max(1,2*t-1))<=s.level;var t}).map(e=>e.name);return e.jsxs("div",{className:"animate-fade-in space-y-6 pb-20",children:[e.jsxs("section",{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-kyoto uppercase tracking-widest text-muted mb-1 pl-1",children:"Vitals"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted opacity-50 mb-3 pl-1 tracking-widest",children:"活力"})]}),e.jsx("div",{className:"stagger-1 animate-slide-up",children:e.jsx(k,{current:s.hp.current,max:s.hp.max,temp:s.hp.temp,onChange:a,onTempChange:r})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mt-4",children:[e.jsx("div",{className:"stagger-2 animate-slide-up",children:e.jsx(P,{spell:s.concentration,suggestions:l.length?l:void 0,onClear:()=>n(x(null)),onSet:e=>n(x(e))})}),s.hp.current<=0&&e.jsx("div",{className:"stagger-3 animate-slide-up",children:e.jsx(H,{successes:s.deathSaves.successes,failures:s.deathSaves.failures,onChange:i})})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-xs font-kyoto uppercase tracking-widest text-muted mb-1 pl-1",children:"Resources"}),e.jsx("div",{className:"text-[10px] font-japanese text-muted opacity-50 mb-3 pl-1 tracking-widest",children:"資源"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("div",{className:"stagger-4 animate-slide-up",children:e.jsx(C,{})}),e.jsx("div",{className:"stagger-5 animate-slide-up",children:e.jsx(S,{})})]})]})]})}export{$ as DashboardView};
